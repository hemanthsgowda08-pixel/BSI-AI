<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO: Primary Meta Tags -->
    <title>BSI AI (Black Storm of India) - Unified Engineering Super Intelligence | Hemanth S Gowda</title>
    <meta name="title" content="BSI AI (Black Storm of India) - Unified Engineering Super Intelligence">
    <meta name="description" content="Access BSI AI (Black Storm of India), the advanced artificial intelligence platform for engineering students and professionals. Specialized modules for Electrical, Civil, Aerospace, Mechanical, and CS/AIML. Designed by Hemanth S Gowda.">
    <meta name="keywords" content="BSI AI, Black Storm of India, BSI Engineering, Hemanth S Gowda, Engineering AI, Electrical Engineering Solver, Civil Engineering AI, Aerospace Calculator, Mechanical Engineering Tool, CS Tutor AI, Artificial Super Intelligence">
    <meta name="robots" content="index, follow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    <meta name="author" content="Hemanth S Gowda">

    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="bsi_logo.jpg">

    <!-- SEO: Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bsiai.web.app/">
    <meta property="og:title" content="BSI AI (Black Storm of India) - Unified Engineering Super Intelligence">
    <meta property="og:description" content="Solve complex engineering problems instantly with BSI AI (Black Storm of India). Featuring MathJax rendering, Mermaid diagrams, and deep technical analysis for 5 major disciplines.">
    <meta property="og:image" content="bsi_logo.jpg">

    <!-- SEO: Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://bsiai.web.app/">
    <meta property="twitter:title" content="BSI AI (Black Storm of India) - Engineering Intelligence">
    <meta property="twitter:description" content="The ultimate AI tool for engineers. Electrical, Civil, Aerospace, Mechanical, and CS modules in one platform by Black Storm of India.">
    <meta property="twitter:image" content="bsi_logo.jpg">

    <!-- SEO: Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "BSI AI",
      "alternateName": ["Black Storm of India", "BSI Engineering Platform"],
      "operatingSystem": "Web Browser",
      "applicationCategory": "EducationalApplication",
      "author": {
        "@type": "Person",
        "name": "Hemanth S Gowda"
      },
      "image": "bsi_logo.jpg",
      "description": "BSI AI (Black Storm of India) is a unified artificial intelligence platform assisting students and professionals in Electrical, Civil, Aerospace, Mechanical, and Computer Science engineering disciplines.",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": "Mermaid.js Diagramming, LaTeX Math Rendering, Multi-disciplinary modules"
    }
    </script>

    <!-- Core Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        darkbg: '#0f172a',
                        lightbg: '#f8fafc',
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            /* Common Variables */
            --primary-color: #3b82f6; 
            --primary-glow: rgba(59, 130, 246, 0.5);
            
            /* Light Mode Defaults */
            --bg-body: #f0f9ff;
            --text-body: #334155;
            --text-heading: #1e293b;
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(203, 213, 225, 0.6);
            --sidebar-hover: rgba(59, 130, 246, 0.1);
            --card-hover-border: rgba(59, 130, 246, 0.4);
            --code-bg: #e2e8f0;
            --input-bg: rgba(255, 255, 255, 0.8);
        }

        /* Dark Mode Overrides */
        html.dark {
            --bg-body: #0f172a;
            --text-body: #e2e8f0;
            --text-heading: #f8fafc;
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --sidebar-hover: rgba(255, 255, 255, 0.05);
            --card-hover-border: rgba(255, 255, 255, 0.2);
            --code-bg: #1e293b;
            --input-bg: rgba(15, 23, 42, 0.5);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-body);
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Sidebar Styling */
        .sidebar-link {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        .sidebar-link:hover, .sidebar-link.active {
            background: linear-gradient(90deg, var(--sidebar-hover) 0%, transparent 100%);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }
        .sidebar-link i {
            width: 24px;
            text-align: center;
        }

        /* Glassmorphism Panels */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            transition: background 0.3s, border-color 0.3s;
        }

        /* Glow Animations */
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 10px var(--primary-glow); }
            50% { box-shadow: 0 0 25px var(--primary-glow); }
            100% { box-shadow: 0 0 10px var(--primary-glow); }
        }
        .ai-glow { animation: pulse-glow 4s infinite ease-in-out; border: 1px solid var(--primary-color); }

        /* Loader */
        .loader {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Markdown Styles */
        .prose pre { background: var(--code-bg) !important; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; border: 1px solid var(--glass-border); }
        .prose code { color: var(--primary-color); background: rgba(125, 125, 125, 0.1); padding: 2px 4px; border-radius: 4px; font-family: 'JetBrains Mono', monospace; }
        .prose h1, .prose h2, .prose h3 { color: var(--text-heading); font-weight: 700; margin-top: 1.5em; }
        .prose strong { color: var(--text-heading); }
        .prose p { margin-bottom: 1em; color: var(--text-body); }
        .prose li { color: var(--text-body); }

        /* Mermaid & MathJax */
        .mermaid { background: rgba(125, 125, 125, 0.05); padding: 10px; border-radius: 8px; text-align: center; margin: 1rem 0; overflow-x: auto; }
        mjx-container { overflow-x: auto; max-width: 100%; }

        /* Utility */
        .hidden-module { display: none; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Toast Notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 100;
            left: 50%;
            bottom: 30px;
            font-size: 14px;
            border: 1px solid var(--primary-color);
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            opacity: 0;
            transition: opacity 0.5s, bottom 0.5s;
        }
        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-body); }
        ::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 4px; }
    </style>
</head>
<body class="flex h-screen overflow-hidden selection:bg-blue-500 selection:text-white">

    <!-- Toast Notification -->
    <div id="toast">Operation Successful</div>

    <!-- Sidebar -->
    <aside class="w-20 md:w-64 flex-shrink-0 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col transition-all duration-300 z-50">
        <div class="h-16 flex items-center justify-center border-b border-slate-200 dark:border-slate-800">
            <!-- Desktop Logo + Text -->
            <div class="hidden md:flex items-center gap-3">
                <img src="bsi_logo.jpg" alt="BSI Logo" class="w-12 h-12 rounded-full object-cover border border-slate-300 dark:border-slate-600 shadow-lg" onerror="this.src='https://via.placeholder.com/48?text=BSI'">
                <h1 class="text-2xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-500 tracking-tighter">BSI AI</h1>
            </div>
            <!-- Mobile Logo -->
            <img src="bsi_logo.jpg" alt="BSI Logo" class="w-12 h-12 rounded-full object-cover border border-slate-300 dark:border-slate-600 md:hidden shadow-lg" onerror="this.src='https://via.placeholder.com/48?text=BSI'">
        </div>

        <nav class="flex-1 overflow-y-auto py-4 space-y-1">
            <button onclick="switchTab('home')" class="sidebar-link w-full text-left px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/50 flex items-center gap-3 active" id="nav-home">
                <i class="fas fa-home"></i>
                <span class="hidden md:inline font-medium">Dashboard</span>
            </button>
            
            <div class="px-4 py-2 mt-4 mb-2 text-xs font-bold text-slate-500 dark:text-slate-600 uppercase tracking-wider hidden md:block">Engineering Modules</div>

            <button onclick="switchTab('electrical')" class="sidebar-link w-full text-left px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 flex items-center gap-3" id="nav-electrical">
                <i class="fas fa-bolt text-emerald-500 dark:text-emerald-400"></i>
                <span class="hidden md:inline font-medium">Electrical AI</span>
            </button>

            <button onclick="switchTab('civil')" class="sidebar-link w-full text-left px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-orange-50 dark:hover:bg-orange-900/20 flex items-center gap-3" id="nav-civil">
                <i class="fas fa-hard-hat text-orange-500 dark:text-orange-400"></i>
                <span class="hidden md:inline font-medium">Civil AI</span>
            </button>

            <button onclick="switchTab('aerospace')" class="sidebar-link w-full text-left px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-sky-50 dark:hover:bg-sky-900/20 flex items-center gap-3" id="nav-aerospace">
                <i class="fas fa-plane-departure text-sky-500 dark:text-sky-400"></i>
                <span class="hidden md:inline font-medium">Aerospace</span>
            </button>

            <button onclick="switchTab('mechanical')" class="sidebar-link w-full text-left px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-amber-50 dark:hover:bg-amber-900/20 flex items-center gap-3" id="nav-mechanical">
                <i class="fas fa-gears text-amber-500 dark:text-amber-400"></i>
                <span class="hidden md:inline font-medium">Mechanical AI</span>
            </button>

            <button onclick="switchTab('cs')" class="sidebar-link w-full text-left px-4 py-3 text-slate-600 dark:text-slate-400 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 flex items-center gap-3" id="nav-cs">
                <i class="fas fa-laptop-code text-indigo-500 dark:text-indigo-400"></i>
                <span class="hidden md:inline font-medium">CS & AIML AI</span>
            </button>
        </nav>

        <div class="p-4 border-t border-slate-200 dark:border-slate-800 text-center">
            <p class="text-xs text-slate-500 dark:text-slate-600 hidden md:block">Designed by Hemanth</p>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 relative overflow-hidden flex flex-col bg-slate-50 dark:bg-[#0f172a] bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] transition-colors duration-300">
        
        <!-- Top Bar -->
        <header class="h-16 glass-panel flex items-center justify-between px-6 z-40">
            <h2 id="page-title" class="text-xl font-bold text-slate-800 dark:text-white tracking-wide transition-colors">Dashboard</h2>
            <div class="flex items-center gap-4">
                
                <!-- Theme Toggle Button -->
                <button onclick="toggleTheme()" class="w-10 h-10 rounded-full flex items-center justify-center text-slate-600 dark:text-slate-300 hover:bg-black/5 dark:hover:bg-white/10 transition-all focus:outline-none" title="Toggle Theme">
                    <i class="fas fa-sun text-lg hidden dark:block text-yellow-400"></i>
                    <i class="fas fa-moon text-lg block dark:hidden text-indigo-600"></i>
                </button>

                <div class="text-xs text-slate-600 dark:text-slate-400 px-3 py-1 rounded-full border border-slate-300 dark:border-slate-700 bg-white/50 dark:bg-slate-800/50">
                    <span class="w-2 h-2 rounded-full bg-green-500 inline-block mr-2 animate-pulse"></span>System Online
                </div>
            </div>
        </header>

        <!-- Content Container -->
        <div class="flex-1 overflow-y-auto p-4 md:p-8 relative scroll-smooth" id="main-scroll">
            
            <!-- 0. HOME DASHBOARD -->
            <div id="module-home" class="fade-in max-w-6xl mx-auto">
                <div class="text-center mb-12 mt-8">
                    <h1 class="text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 dark:from-blue-400 dark:via-purple-500 dark:to-pink-500 mb-4 drop-shadow-xl">
                        BSI AI
                    </h1>
                    <p class="text-xl text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">Access specialized artificial super-intelligence modules for every engineering discipline.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
                    <!-- Cards -->
                    <div onclick="switchTab('electrical')" class="glass-panel p-6 rounded-2xl hover:scale-105 transition-transform cursor-pointer group border-emerald-500/20 hover:border-emerald-500">
                        <div class="w-12 h-12 rounded-lg bg-emerald-100 dark:bg-emerald-500/20 flex items-center justify-center mb-4 group-hover:bg-emerald-500 text-emerald-600 dark:text-emerald-400 group-hover:text-white transition-colors">
                            <i class="fas fa-bolt text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 dark:text-emerald-100 mb-2">Electrical AI</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400">Circuit Theory, Analog/Digital Electronics, and Signal Processing.</p>
                    </div>

                    <div onclick="switchTab('civil')" class="glass-panel p-6 rounded-2xl hover:scale-105 transition-transform cursor-pointer group border-orange-500/20 hover:border-orange-500">
                        <div class="w-12 h-12 rounded-lg bg-orange-100 dark:bg-orange-500/20 flex items-center justify-center mb-4 group-hover:bg-orange-500 text-orange-600 dark:text-orange-400 group-hover:text-white transition-colors">
                            <i class="fas fa-hard-hat text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 dark:text-orange-100 mb-2">Civil AI</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400">Structural Analysis, Fluid Mechanics, and Construction Management.</p>
                    </div>

                    <div onclick="switchTab('aerospace')" class="glass-panel p-6 rounded-2xl hover:scale-105 transition-transform cursor-pointer group border-sky-500/20 hover:border-sky-500">
                        <div class="w-12 h-12 rounded-lg bg-sky-100 dark:bg-sky-500/20 flex items-center justify-center mb-4 group-hover:bg-sky-500 text-sky-600 dark:text-sky-400 group-hover:text-white transition-colors">
                            <i class="fas fa-plane-departure text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 dark:text-sky-100 mb-2">Aerospace</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400">Astrodynamics, Rocket Propulsion, and Aerodynamics.</p>
                    </div>

                    <div onclick="switchTab('mechanical')" class="glass-panel p-6 rounded-2xl hover:scale-105 transition-transform cursor-pointer group border-amber-500/20 hover:border-amber-500">
                        <div class="w-12 h-12 rounded-lg bg-amber-100 dark:bg-amber-500/20 flex items-center justify-center mb-4 group-hover:bg-amber-500 text-amber-600 dark:text-amber-400 group-hover:text-white transition-colors">
                            <i class="fas fa-gears text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 dark:text-amber-100 mb-2">Mechanical AI</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400">Thermodynamics, Manufacturing, and Kinematics of Machinery.</p>
                    </div>

                    <div onclick="switchTab('cs')" class="glass-panel p-6 rounded-2xl hover:scale-105 transition-transform cursor-pointer group border-indigo-500/20 hover:border-indigo-500">
                        <div class="w-12 h-12 rounded-lg bg-indigo-100 dark:bg-indigo-500/20 flex items-center justify-center mb-4 group-hover:bg-indigo-500 text-indigo-600 dark:text-indigo-400 group-hover:text-white transition-colors">
                            <i class="fas fa-laptop-code text-xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 dark:text-indigo-100 mb-2">CS & AIML AI</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400">Neural Networks, Algorithms, and Data Structures.</p>
                    </div>
                </div>
            </div>

            <!-- 1. ELECTRICAL MODULE -->
            <div id="module-electrical" class="hidden-module fade-in max-w-4xl mx-auto">
                <div class="glass-panel rounded-2xl p-6 md:p-8 ai-glow relative" style="--primary-color: #10b981;">
                    <h2 class="text-3xl font-bold text-emerald-600 dark:text-emerald-400 mb-6 flex items-center gap-3"><i class="fas fa-bolt"></i> HemElectroAI</h2>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium text-emerald-700 dark:text-emerald-300">Circuit Problem or Topic</label>
                        <div class="relative">
                            <textarea id="electrical-input" rows="6" class="w-full p-4 bg-white/50 dark:bg-slate-900/50 border border-emerald-500/30 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-base text-slate-800 dark:text-slate-100 placeholder-emerald-600/40 dark:placeholder-emerald-500/40" placeholder="e.g., Calculate the cutoff frequency of this RC circuit..."></textarea>
                            <button onclick="clearInput('electrical-input')" class="absolute top-3 right-3 text-emerald-500 hover:text-emerald-700 dark:hover:text-white transition-colors"><i class="fas fa-times"></i></button>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-6">
                        <button class="px-4 py-2 text-sm font-medium text-emerald-700 dark:text-emerald-300 bg-emerald-100 dark:bg-emerald-900/30 border border-emerald-500/30 rounded-full hover:bg-emerald-500 hover:text-white transition-all" onclick="setPrompt('electrical-input', 'Explain Kirchhoff\'s Voltage Law')">Explain KVL</button>
                        <button class="px-4 py-2 text-sm font-medium text-emerald-700 dark:text-emerald-300 bg-emerald-100 dark:bg-emerald-900/30 border border-emerald-500/30 rounded-full hover:bg-emerald-500 hover:text-white transition-all" onclick="setPrompt('electrical-input', 'Design a Low Pass Filter')">Design LP Filter</button>
                        <button class="px-4 py-2 text-sm font-medium text-emerald-700 dark:text-emerald-300 bg-emerald-100 dark:bg-emerald-900/30 border border-emerald-500/30 rounded-full hover:bg-emerald-500 hover:text-white transition-all" onclick="setPrompt('electrical-input', 'Difference between BJT and FET')">BJT vs FET</button>
                    </div>

                    <div class="flex justify-end mb-6">
                        <button onclick="handleQuery('electrical')" class="w-full md:w-auto px-8 py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-bold text-lg rounded-lg shadow-lg shadow-emerald-500/20 transition-all hover:scale-105">Solve Circuit</button>
                    </div>

                    <div id="electrical-result-area" class="hidden border-t border-emerald-500/20 pt-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-emerald-700 dark:text-emerald-300">Analysis Result</h3>
                            <button onclick="copyToClipboard('electrical-response')" class="text-xs text-emerald-600 dark:text-emerald-400 hover:text-emerald-800 dark:hover:text-white"><i class="fas fa-copy"></i> Copy</button>
                        </div>
                        <div id="electrical-loader" class="flex justify-center py-8 hidden"><div class="loader" style="--primary-color: #10b981;"></div></div>
                        <div id="electrical-response" class="prose max-w-none prose-emerald dark:prose-invert bg-white/50 dark:bg-slate-900/50 p-4 rounded-lg border border-emerald-500/10 min-h-[300px]"></div>
                    </div>

                      <!-- Knowledge Base -->
                    <div class="mt-8 pt-8 border-t border-slate-300 dark:border-slate-700/50">
                        <h3 class="text-xl font-semibold text-emerald-700 dark:text-emerald-200 mb-3">Electrical Engineering Core Concepts</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mb-2">Electrical engineering relies on fundamental laws such as <strong>Ohm's Law</strong> and <strong>Kirchhoff's Laws</strong>. Understanding passive components (resistors, capacitors, inductors) and active components (transistors, op-amps) is crucial.</p>
                    </div>
                </div>
            </div>

            <!-- 2. CIVIL MODULE -->
            <div id="module-civil" class="hidden-module fade-in max-w-4xl mx-auto">
                <div class="glass-panel rounded-2xl p-6 md:p-8 ai-glow relative" style="--primary-color: #f97316;">
                    <h2 class="text-3xl font-bold text-orange-600 dark:text-orange-400 mb-6 flex items-center gap-3"><i class="fas fa-hard-hat"></i> HemCivilAI</h2>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium text-orange-700 dark:text-orange-300">Ask the Engineer</label>
                        <div class="relative">
                            <textarea id="civil-input" rows="6" class="w-full p-4 bg-white/50 dark:bg-slate-900/50 border border-orange-500/30 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-base text-slate-800 dark:text-slate-100 placeholder-orange-600/40 dark:placeholder-orange-500/40" placeholder="e.g., Explain the failure mechanism of a retaining wall..."></textarea>
                            <button onclick="clearInput('civil-input')" class="absolute top-3 right-3 text-orange-500 hover:text-orange-700 dark:hover:text-white transition-colors"><i class="fas fa-times"></i></button>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-6">
                        <button class="px-4 py-2 text-sm font-medium text-orange-700 dark:text-orange-300 bg-orange-100 dark:bg-orange-900/30 border border-orange-500/30 rounded-full hover:bg-orange-500 hover:text-white transition-all" onclick="setPrompt('civil-input', 'Explain Bernoulli\'s principle')">Bernoulli's Principle</button>
                        <button class="px-4 py-2 text-sm font-medium text-orange-700 dark:text-orange-300 bg-orange-100 dark:bg-orange-900/30 border border-orange-500/30 rounded-full hover:bg-orange-500 hover:text-white transition-all" onclick="setPrompt('civil-input', 'Flowchart for Concrete Mix Design')">Concrete Mix Flowchart</button>
                        <button class="px-4 py-2 text-sm font-medium text-orange-700 dark:text-orange-300 bg-orange-100 dark:bg-orange-900/30 border border-orange-500/30 rounded-full hover:bg-orange-500 hover:text-white transition-all" onclick="setPrompt('civil-input', 'Calculate Stopping Sight Distance')">Stopping Sight Distance</button>
                    </div>

                    <div class="flex justify-end mb-6">
                        <button onclick="handleQuery('civil')" class="w-full md:w-auto px-8 py-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-400 hover:to-red-400 text-white font-bold text-lg rounded-lg shadow-lg shadow-orange-500/20 transition-all hover:scale-105">Analyze Structure</button>
                    </div>

                    <div id="civil-result-area" class="hidden border-t border-orange-500/20 pt-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-orange-700 dark:text-orange-300">Engineering Analysis</h3>
                            <button onclick="copyToClipboard('civil-response')" class="text-xs text-orange-600 dark:text-orange-400 hover:text-orange-800 dark:hover:text-white"><i class="fas fa-copy"></i> Copy</button>
                        </div>
                        <div id="civil-loader" class="flex justify-center py-8 hidden"><div class="loader" style="--primary-color: #f97316;"></div></div>
                        <div id="civil-response" class="prose max-w-none prose-orange dark:prose-invert bg-white/50 dark:bg-slate-900/50 p-4 rounded-lg border border-orange-500/10 min-h-[300px]"></div>
                    </div>
                    
                    <!-- Knowledge Base -->
                    <div class="mt-8 pt-8 border-t border-slate-300 dark:border-slate-700/50">
                        <h3 class="text-xl font-semibold text-orange-700 dark:text-orange-200 mb-3">Civil Engineering Fundamentals</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mb-2">Key disciplines include <strong>Structural Engineering</strong>, <strong>Geotechnical Engineering</strong>, and <strong>Fluid Mechanics</strong>.</p>
                    </div>
                </div>
            </div>

            <!-- 3. AEROSPACE MODULE -->
            <div id="module-aerospace" class="hidden-module fade-in max-w-4xl mx-auto">
                <div class="glass-panel rounded-2xl p-6 md:p-8 ai-glow relative" style="--primary-color: #0ea5e9;">
                    <h2 class="text-3xl font-bold text-sky-600 dark:text-sky-400 mb-6 flex items-center gap-3"><i class="fas fa-plane-departure"></i> AeroHem</h2>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium text-sky-700 dark:text-sky-300">Advanced Aerospace Query</label>
                        <div class="relative">
                            <textarea id="aerospace-input" rows="6" class="w-full p-4 bg-white/50 dark:bg-slate-900/50 border border-sky-500/30 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 text-base text-slate-800 dark:text-slate-100 placeholder-sky-600/40 dark:placeholder-sky-500/40" placeholder="e.g., Calculate delta-V for a Hohmann transfer from LEO to GEO..."></textarea>
                            <button onclick="clearInput('aerospace-input')" class="absolute top-3 right-3 text-sky-500 hover:text-sky-700 dark:hover:text-white transition-colors"><i class="fas fa-times"></i></button>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-6">
                        <button class="px-4 py-2 text-sm font-medium text-sky-700 dark:text-sky-300 bg-sky-100 dark:bg-sky-900/30 border border-sky-500/30 rounded-full hover:bg-sky-500 hover:text-white transition-all" onclick="setPrompt('aerospace-input', 'Calculate Hohmann Transfer LEO to GEO')">Hohmann Transfer</button>
                        <button class="px-4 py-2 text-sm font-medium text-sky-700 dark:text-sky-300 bg-sky-100 dark:bg-sky-900/30 border border-sky-500/30 rounded-full hover:bg-sky-500 hover:text-white transition-all" onclick="setPrompt('aerospace-input', 'Derive Tsiolkovsky Rocket Equation')">Rocket Equation</button>
                        <button class="px-4 py-2 text-sm font-medium text-sky-700 dark:text-sky-300 bg-sky-100 dark:bg-sky-900/30 border border-sky-500/30 rounded-full hover:bg-sky-500 hover:text-white transition-all" onclick="setPrompt('aerospace-input', 'Oblique Shock Wave Relations')">Shock Waves</button>
                    </div>

                    <div class="flex justify-end mb-6">
                        <button onclick="handleQuery('aerospace')" class="w-full md:w-auto px-8 py-3 bg-sky-600 hover:bg-sky-500 text-white font-bold text-lg rounded-lg shadow-lg shadow-sky-500/20 transition-all hover:scale-105">Launch Query</button>
                    </div>

                    <div id="aerospace-result-area" class="hidden border-t border-sky-500/20 pt-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-sky-700 dark:text-sky-300">Mission Data</h3>
                            <button onclick="copyToClipboard('aerospace-response')" class="text-xs text-sky-600 dark:text-sky-400 hover:text-sky-800 dark:hover:text-white"><i class="fas fa-copy"></i> Copy</button>
                        </div>
                        <div id="aerospace-loader" class="flex justify-center py-8 hidden"><div class="loader" style="--primary-color: #0ea5e9;"></div></div>
                        <div id="aerospace-response" class="prose max-w-none prose-sky dark:prose-invert bg-white/50 dark:bg-slate-900/50 p-4 rounded-lg border border-sky-500/10 min-h-[300px]"></div>
                    </div>

                    <!-- Knowledge Base -->
                    <div class="mt-8 pt-8 border-t border-slate-300 dark:border-slate-700/50">
                        <h3 class="text-xl font-semibold text-sky-700 dark:text-sky-200 mb-3">Aerospace & Astrodynamics Principles</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mb-2">Focus on <strong>Astrodynamics</strong>, <strong>Propulsion</strong>, and <strong>Aerodynamics</strong>.</p>
                    </div>
                </div>
            </div>

            <!-- 4. MECHANICAL MODULE -->
            <div id="module-mechanical" class="hidden-module fade-in max-w-4xl mx-auto">
                <div class="glass-panel rounded-2xl p-6 md:p-8 ai-glow relative" style="--primary-color: #f59e0b;">
                    <h2 class="text-3xl font-bold text-amber-600 dark:text-amber-400 mb-6 flex items-center gap-3"><i class="fas fa-gears"></i> Hem MechGenius</h2>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium text-amber-700 dark:text-amber-300">Engineering Query</label>
                        <div class="relative">
                            <textarea id="mechanical-input" rows="6" class="w-full p-4 bg-white/50 dark:bg-slate-900/50 border border-amber-500/30 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-base text-slate-800 dark:text-slate-100 placeholder-amber-600/40 dark:placeholder-amber-500/40" placeholder="e.g., Explain the efficiency of the Carnot Cycle..."></textarea>
                            <button onclick="clearInput('mechanical-input')" class="absolute top-3 right-3 text-amber-500 hover:text-amber-700 dark:hover:text-white transition-colors"><i class="fas fa-times"></i></button>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-6">
                        <button class="px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 border border-amber-500/30 rounded-full hover:bg-amber-500 hover:text-white transition-all" onclick="setPrompt('mechanical-input', 'Explain the Second Law of Thermodynamics')">2nd Law Thermo</button>
                        <button class="px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 border border-amber-500/30 rounded-full hover:bg-amber-500 hover:text-white transition-all" onclick="setPrompt('mechanical-input', 'Difference between Otto and Diesel Cycle')">Otto vs Diesel</button>
                        <button class="px-4 py-2 text-sm font-medium text-amber-700 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/30 border border-amber-500/30 rounded-full hover:bg-amber-500 hover:text-white transition-all" onclick="setPrompt('mechanical-input', 'Stress-Strain diagram for mild steel')">Stress-Strain Diagram</button>
                    </div>

                    <div class="flex justify-end mb-6">
                        <button onclick="handleQuery('mechanical')" class="w-full md:w-auto px-8 py-3 bg-amber-600 hover:bg-amber-500 text-white font-bold text-lg rounded-lg shadow-lg shadow-amber-500/20 transition-all hover:scale-105">Process</button>
                    </div>

                    <div id="mechanical-result-area" class="hidden border-t border-amber-500/20 pt-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-amber-700 dark:text-amber-300">Generated Solution</h3>
                            <button onclick="copyToClipboard('mechanical-response')" class="text-xs text-amber-600 dark:text-amber-400 hover:text-amber-800 dark:hover:text-white"><i class="fas fa-copy"></i> Copy</button>
                        </div>
                        <div id="mechanical-loader" class="flex justify-center py-8 hidden"><div class="loader" style="--primary-color: #f59e0b;"></div></div>
                        <div id="mechanical-response" class="prose max-w-none prose-amber dark:prose-invert bg-white/50 dark:bg-slate-900/50 p-4 rounded-lg border border-amber-500/10 min-h-[300px]"></div>
                    </div>
                    
                    <!-- Knowledge Base -->
                    <div class="mt-8 pt-8 border-t border-slate-300 dark:border-slate-700/50">
                        <h3 class="text-xl font-semibold text-amber-700 dark:text-amber-200 mb-3">Mechanical Systems & Thermodynamics</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mb-2">Focus on <strong>Thermodynamics</strong>, <strong>Kinematics</strong>, and <strong>Strength of Materials</strong>.</p>
                    </div>
                </div>
            </div>

            <!-- 5. CS & AIML MODULE -->
            <div id="module-cs" class="hidden-module fade-in max-w-4xl mx-auto">
                <div class="glass-panel rounded-2xl p-6 md:p-8 ai-glow relative" style="--primary-color: #6366f1;">
                    <h2 class="text-3xl font-bold text-indigo-600 dark:text-indigo-400 mb-6 flex items-center gap-3"><i class="fas fa-laptop-code"></i> HemTutoai</h2>
                    
                    <div class="mb-4">
                        <label class="block mb-2 text-sm font-medium text-indigo-700 dark:text-indigo-300">CS & AIML Query</label>
                        <div class="relative">
                            <textarea id="cs-input" rows="6" class="w-full p-4 bg-white/50 dark:bg-slate-900/50 border border-indigo-500/30 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-base text-slate-800 dark:text-slate-100 placeholder-indigo-600/40 dark:placeholder-indigo-500/40" placeholder="e.g., Explain the architecture of a transformer model..."></textarea>
                            <button onclick="clearInput('cs-input')" class="absolute top-3 right-3 text-indigo-500 hover:text-indigo-700 dark:hover:text-white transition-colors"><i class="fas fa-times"></i></button>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-6">
                        <button class="px-4 py-2 text-sm font-medium text-indigo-700 dark:text-indigo-300 bg-indigo-100 dark:bg-indigo-900/30 border border-indigo-500/30 rounded-full hover:bg-indigo-500 hover:text-white transition-all" onclick="setPrompt('cs-input', 'What is a neural network?')">Neural Network</button>
                        <button class="px-4 py-2 text-sm font-medium text-indigo-700 dark:text-indigo-300 bg-indigo-100 dark:bg-indigo-900/30 border border-indigo-500/30 rounded-full hover:bg-indigo-500 hover:text-white transition-all" onclick="setPrompt('cs-input', 'Compare CNNs and RNNs')">CNN vs RNN</button>
                        <button class="px-4 py-2 text-sm font-medium text-indigo-700 dark:text-indigo-300 bg-indigo-100 dark:bg-indigo-900/30 border border-indigo-500/30 rounded-full hover:bg-indigo-500 hover:text-white transition-all" onclick="setPrompt('cs-input', 'Flowchart for binary search')">Binary Search Flow</button>
                    </div>

                    <div class="flex justify-end mb-6">
                        <button onclick="handleQuery('cs')" class="w-full md:w-auto px-8 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold text-lg rounded-lg shadow-lg shadow-indigo-500/20 transition-all hover:scale-105">Compile</button>
                    </div>

                    <div id="cs-result-area" class="hidden border-t border-indigo-500/20 pt-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-indigo-700 dark:text-indigo-300">Output</h3>
                            <button onclick="copyToClipboard('cs-response')" class="text-xs text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-white"><i class="fas fa-copy"></i> Copy</button>
                        </div>
                        <div id="cs-loader" class="flex justify-center py-8 hidden"><div class="loader" style="--primary-color: #6366f1;"></div></div>
                        <div id="cs-response" class="prose max-w-none prose-indigo dark:prose-invert bg-white/50 dark:bg-slate-900/50 p-4 rounded-lg border border-indigo-500/10 min-h-[300px]"></div>
                    </div>
                    
                      <!-- Knowledge Base -->
                    <div class="mt-8 pt-8 border-t border-slate-300 dark:border-slate-700/50">
                        <h3 class="text-xl font-semibold text-indigo-700 dark:text-indigo-200 mb-3">Computer Science & AI Paradigms</h3>
                        <p class="text-sm text-slate-600 dark:text-slate-400 mb-2">Deep dive into <strong>Data Structures</strong>, <strong>Algorithms</strong>, and <strong>Machine Learning</strong>.</p>
                    </div>
                </div>
            </div>

            <!-- GLOBAL FOOTER -->
            <div id="global-footer-section" class="mt-12 pb-8 max-w-6xl mx-auto px-4">
                
                <!-- ABOUT SECTION -->
                <div class="glass-panel p-8 rounded-2xl border-slate-300 dark:border-slate-700/50 mb-12 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl -mr-32 -mt-32 pointer-events-none"></div>
                    
                    <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-6 flex items-center gap-3">
                        <i class="fas fa-layer-group text-blue-500"></i> About BSI AI Platform
                    </h2>
                    
                    <div class="prose prose-invert max-w-none text-slate-600 dark:text-slate-300 leading-relaxed">
                        <p class="mb-6 text-lg">
                            BSI AI is a comprehensive, unified engineering intelligence platform designed to assist students, researchers, and professionals across multiple engineering disciplines. Our system integrates state-of-the-art Large Language Models (LLMs) with specialized prompt engineering to deliver accurate, mathematically rigorous, and context-aware solutions.
                        </p>
                        
                        <p class="mb-4 text-slate-500 dark:text-slate-400 font-medium">Unlike generic AI tools, BSI AI is partitioned into distinct modules:</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                            <div class="bg-white/50 dark:bg-slate-800/50 p-5 rounded-xl border border-slate-200 dark:border-slate-700 hover:border-emerald-500/50 transition-colors">
                                <strong class="text-emerald-600 dark:text-emerald-400 block mb-1"><i class="fas fa-bolt mr-2"></i>Electrical Engineering</strong>
                                <span class="text-sm text-slate-600 dark:text-slate-400">Focused on circuit analysis, signal processing, and electromagnetic field theory using precise mathematical derivations.</span>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-slate-800/50 p-5 rounded-xl border border-slate-200 dark:border-slate-700 hover:border-orange-500/50 transition-colors">
                                <strong class="text-orange-600 dark:text-orange-400 block mb-1"><i class="fas fa-hard-hat mr-2"></i>Civil Engineering</strong>
                                <span class="text-sm text-slate-600 dark:text-slate-400">Specialized in structural integrity, fluid dynamics, and geotechnical engineering standards.</span>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-slate-800/50 p-5 rounded-xl border border-slate-200 dark:border-slate-700 hover:border-sky-500/50 transition-colors">
                                <strong class="text-sky-600 dark:text-sky-400 block mb-1"><i class="fas fa-plane-departure mr-2"></i>Aerospace Engineering</strong>
                                <span class="text-sm text-slate-600 dark:text-slate-400">Tailored for astrodynamics, propulsion systems, and aerodynamic fluid flow simulations.</span>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-slate-800/50 p-5 rounded-xl border border-slate-200 dark:border-slate-700 hover:border-amber-500/50 transition-colors">
                                <strong class="text-amber-600 dark:text-amber-400 block mb-1"><i class="fas fa-gears mr-2"></i>Mechanical Engineering</strong>
                                <span class="text-sm text-slate-600 dark:text-slate-400">Optimized for thermodynamics cycles, kinematics, and material science analysis.</span>
                            </div>
                            
                            <div class="bg-white/50 dark:bg-slate-800/50 p-5 rounded-xl border border-slate-200 dark:border-slate-700 md:col-span-2 hover:border-indigo-500/50 transition-colors">
                                <strong class="text-indigo-600 dark:text-indigo-400 block mb-1"><i class="fas fa-laptop-code mr-2"></i>CS & AIML</strong>
                                <span class="text-sm text-slate-600 dark:text-slate-400">Dedicated to algorithm optimization, data structure visualization, and neural network architecture explanation.</span>
                            </div>
                        </div>

                        <p class="text-slate-500 dark:text-slate-400 italic border-l-4 border-blue-500 pl-4">
                            "Our mission is to democratize access to high-level engineering problem-solving capabilities, providing instant analysis, diagrammatic representations via Mermaid.js, and LaTeX-formatted mathematical proofs."
                        </p>
                    </div>
                </div>

                <footer class="border-t border-slate-300 dark:border-slate-800 pt-10 pb-6 text-center">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8 text-left">
                        <div>
                            <h4 class="text-slate-800 dark:text-white font-bold mb-4">Connect</h4>
                             <div class="flex flex-col space-y-3">
                                <a href="https://www.instagram.com/bsi_web" target="_blank" class="group flex items-center gap-3 text-slate-600 dark:text-slate-400 hover:text-pink-500 transition-all">
                                    <div class="w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-800 group-hover:bg-pink-500/20 flex items-center justify-center transition-colors">
                                        <i class="fab fa-instagram text-lg"></i>
                                    </div>
                                    <span class="text-sm font-medium">Instagram</span>
                                </a>
                                <a href="https://www.youtube.com/@hemri1708" target="_blank" class="group flex items-center gap-3 text-slate-600 dark:text-slate-400 hover:text-red-500 transition-all">
                                    <div class="w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-800 group-hover:bg-red-500/20 flex items-center justify-center transition-colors">
                                        <i class="fab fa-youtube text-lg"></i>
                                    </div>
                                    <span class="text-sm font-medium">YouTube</span>
                                </a>
                            </div>
                        </div>
                        <div class="md:col-span-2">
                            <h4 class="text-slate-800 dark:text-white font-bold mb-4">Architect & Developer</h4>
                            <div class="bg-white/50 dark:bg-slate-800/30 rounded-xl p-4 border border-slate-200 dark:border-slate-700/50 flex flex-col sm:flex-row gap-4 items-start">
                                <div class="flex-shrink-0">
                                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white text-xl font-bold shadow-lg shadow-blue-900/20">
                                        HSG
                                    </div>
                                </div>
                                <div>
                                    <h5 class="text-blue-600 dark:text-blue-400 font-bold text-lg mb-1">Hemanth S Gowda</h5>
                                    <p class="text-sm text-slate-600 dark:text-slate-400 leading-relaxed">
                                        Hemanth S Gowda is the visionary Architect and Lead Developer behind the BSI AI platform. Driven by a passion to bridge the gap between complex engineering theory and accessible technology, he designed this unified intelligence system to empower students and researchers globally. His work integrates advanced LLM capabilities with precise engineering logic, setting a new standard for educational AI tools.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="border-t border-slate-300 dark:border-slate-800 pt-6 text-slate-500 dark:text-slate-600 text-xs">
                        <p>&copy; 2024 BSI AI Engineering Platform. Designed & Developed by Hemanth S Gowda.</p>
                    </div>
                </footer>
            </div>

        </div>
    </main>

    <script>
        const apiKey = ""; // System injected key fallback

        const moduleConfigs = {
            electrical: {
                name: 'HemElectroAI',
                apiKey: '', // Fixed: Hardcoded from original file
                prompt: `You are 'HemElectroAI', an AI expert in Electronics & Communication Engineering (ECE). Expertise: Circuit Theory, Analog/Digital Electronics, Signals & Systems, Electromagnetics. Provide step-by-step derivations using LaTeX ($ for inline, $$ for block). Use Mermaid.js for diagrams (graph TD). Start with 'graph TD'. Always quote node labels ("Label").`
            },
            civil: {
                name: 'HemCivilAI',
                apiKey: '', // Fixed: Hardcoded from original file
                prompt: `You are 'HemCivilAI', specialized in Civil Engineering (Structural, Geotechnical, Fluid Mechanics). Use Markdown. Use LaTeX for equations. Use Mermaid.js for flowcharts. Start with 'graph TD'. Always quote node labels.`
            },
            aerospace: {
                name: 'AeroHem',
                apiKey: 'AIzaSyBof1D4ePdhUp8CuyAC3pvxzVfM8OhBPN4', // Fixed: Hardcoded from original file
                prompt: `You are 'AeroHem', specialized in Aerospace Engineering (Astrodynamics, Propulsion, Aerodynamics). Provide rigorous technical solutions. Use LaTeX for math. Use Mermaid for diagrams. Start with 'graph TD'. Always quote node labels.`
            },
            mechanical: {
                name: 'MechGenius',
                apiKey: '', // Fixed: Hardcoded from original file
                prompt: `You are 'MechGenius', specialized in Mechanical Engineering (Thermodynamics, Fluid Mechanics, Kinematics). Use Markdown, LaTeX, and Mermaid.js. Start with 'graph TD'. Always quote node labels.`
            },
            cs: {
                name: 'HemTutoai',
                apiKey: '', // Fixed: Hardcoded from original file
                prompt: `You are 'HemTutoai', for CS & AIML students. Short, correct, concise answers. Use Markdown. Use Mermaid.js for diagrams. Start with 'graph TD'. Always quote node labels.`
            }
        };

        // --- Theme Toggle Logic ---
        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        // Initialize Theme from LocalStorage
        (function() {
            const savedTheme = localStorage.getItem('theme');
            const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        })();

        // --- Tab Switching Logic ---
        function switchTab(moduleId) {
            const modules = ['home', 'electrical', 'civil', 'aerospace', 'mechanical', 'cs'];
            modules.forEach(id => {
                const mod = document.getElementById('module-' + id);
                const nav = document.getElementById('nav-' + id);
                if(mod) mod.classList.add('hidden-module');
                if(nav) nav.classList.remove('active', 'bg-slate-100', 'dark:bg-slate-800/50', 'text-white');
                
                // Reset basic style for inactive tabs
                if(nav) {
                    nav.classList.remove('bg-slate-100', 'dark:bg-slate-800/50', 'text-blue-600', 'dark:text-white');
                    nav.classList.add('text-slate-600', 'dark:text-slate-400');
                }
            });

            const selectedMod = document.getElementById('module-' + moduleId);
            if(selectedMod) {
                selectedMod.classList.remove('hidden-module');
                selectedMod.classList.add('fade-in');
            }
            
            const selectedNav = document.getElementById('nav-' + moduleId);
            if(selectedNav) {
                selectedNav.classList.remove('text-slate-600', 'dark:text-slate-400');
                selectedNav.classList.add('active', 'bg-slate-100', 'dark:bg-slate-800/50', 'text-blue-600', 'dark:text-white');
            }

            const root = document.documentElement;
            const title = document.getElementById('page-title');
            
            const colors = {
                home: { c: '#3b82f6', t: 'Dashboard' },
                electrical: { c: '#10b981', t: 'Electrical AI' },
                civil: { c: '#f97316', t: 'Civil AI' },
                aerospace: { c: '#0ea5e9', t: 'Aerospace AI' },
                mechanical: { c: '#f59e0b', t: 'Mechanical AI' },
                cs: { c: '#6366f1', t: 'CS & AIML AI' }
            };

            if(colors[moduleId]) {
                root.style.setProperty('--primary-color', colors[moduleId].c);
                root.style.setProperty('--primary-glow', `${colors[moduleId].c}80`); // 50% opacity hex approximation
                title.innerText = colors[moduleId].t;
            }
        }

        // --- Utility Functions ---
        function setPrompt(inputId, text) {
            document.getElementById(inputId).value = text;
        }

        function clearInput(inputId) {
            document.getElementById(inputId).value = '';
        }

        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.className = "show";
            toast.innerText = message;
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).innerText;
            
            // Modern Async API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                      showToast('Copied to clipboard!');
                }).catch(err => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
             const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showToast('Copied to clipboard!');
            } catch (err) {
                showToast('Failed to copy');
            }
            document.body.removeChild(textArea);
        }

        // --- API & Handling Logic ---
        async function fetchWithRetry(url, options, retries = 5, delay = 1000) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (err) {
                if (retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return fetchWithRetry(url, options, retries - 1, delay * 2);
                } else {
                    throw err;
                }
            }
        }

        async function handleQuery(moduleId) {
            const inputId = moduleId + '-input';
            const resultAreaId = moduleId + '-result-area';
            const loaderId = moduleId + '-loader';
            const responseId = moduleId + '-response';

            const input = document.getElementById(inputId);
            const resultArea = document.getElementById(resultAreaId);
            const loader = document.getElementById(loaderId);
            const responseDiv = document.getElementById(responseId);

            if(!input.value.trim()) return;
            
            resultArea.classList.remove('hidden');
            loader.classList.remove('hidden');
            responseDiv.innerHTML = '';

            const config = moduleConfigs[moduleId];
            if (!config) return;

            // Use the specific API key for this module, or fall back to system key
            // CRITICAL FIX: The hardcoded key in moduleConfigs takes precedence
            const keyToUse = config.apiKey || apiKey;

            try {
                // Fixed: Use 2.5-flash-preview-09-2025 to match original file's working config
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${keyToUse}`, 
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: input.value }] }],
                            systemInstruction: { parts: [{ text: config.prompt }] },
                        })
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}. Please check API key quotas.`);
                }

                const data = await response.json();
                
                if (!data.candidates || data.candidates.length === 0) {
                      let errorMsg = "No response generated.";
                      if (data.promptFeedback && data.promptFeedback.blockReason) {
                          errorMsg = `Response blocked: ${data.promptFeedback.blockReason}`;
                      }
                      throw new Error(errorMsg);
                }

                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "No text content found.";
                await displayResponse(responseId, text);
            } catch (e) {
                responseDiv.innerHTML = `<div class="text-red-400 p-4 border border-red-500/30 rounded bg-red-900/20">Error: ${e.message}. Please try again later.</div>`;
            } finally {
                loader.classList.add('hidden');
            }
        }

        // --- Display Logic ---
        async function displayResponse(containerId, text) {
            const container = document.getElementById(containerId);
            
            // 1. Markdown Parse
            container.innerHTML = marked.parse(text);

            // 2. Mermaid Processing
            // Improved selector to catch different markdown rendering outcomes
            const mermaidBlocks = container.querySelectorAll('pre code.language-mermaid, div.mermaid, pre.mermaid');
            const mermaidNodes = [];

            mermaidBlocks.forEach((block, index) => {
                const pre = block.closest('pre'); // Find parent pre tag if inside one
                const div = document.createElement('div');
                div.className = 'mermaid';
                div.id = `mermaid-${containerId}-${index}`;
                
                let code = block.textContent.trim();
                code = code.replace(/&gt;/g, '>').replace(/&lt;/g, '<').replace(/&amp;/g, '&');
                
                // Robust Fix for LLM Mermaid Syntax Errors
                // 1. Force "graph TD" (or similar) to be on its own line
                code = code.replace(/^(graph\s+(?:TD|TB|BT|RL|LR))([^\s\n])/im, '$1\n$2');
                
                // 2. Fix unquoted text in decision nodes (common LLM error)
                // Converts {Text(More)} to {"Text(More)"}
                code = code.replace(/(\w+)\{([^"}\n]*?\(.*?\)[^"}\n]*?)\}/g, '$1{"$2"}');
                
                // 3. Fix unquoted text in square nodes
                // Converts [Text(More)] to ["Text(More)"]
                code = code.replace(/(\w+)\[([^"\]\n]*?\(.*?\)[^"\]\n]*?)\]/g, '$1["$2"]');
                
                div.textContent = code;
                
                if (pre) {
                    pre.replaceWith(div);
                } else {
                    block.replaceWith(div);
                }
                mermaidNodes.push(div);
            });

            if(mermaidNodes.length > 0) {
                try {
                    // Using current Mermaid v10 API
                    await mermaid.run({ nodes: mermaidNodes });
                } catch(e) {
                    console.warn("Mermaid render error:", e);
                    // Fallback to text if render fails
                    mermaidNodes.forEach(node => {
                        node.innerHTML = `<div style="color:red; border:1px solid red; padding:5px;">Mermaid Syntax Error (Render Failed)</div><pre>${node.textContent}</pre>`;
                    });
                }
            }

            // 3. MathJax Typeset
            if (window.MathJax) {
                try { 
                    await MathJax.typesetPromise([container]); 
                } catch (e) { 
                    console.warn("MathJax error:", e); 
                }
            }
        }

        // Initialization
        window.addEventListener('load', () => {
            mermaid.initialize({ startOnLoad: false, theme: 'dark', securityLevel: 'loose' });
        });
    </script>
</body>
</html>


